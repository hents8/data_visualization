{# Expects: labels (array), data (array) #}

<div class="chart-container">
    <canvas id="{{ id|default('chart-doughnut') }}"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
    const ctx_{{ id|default('chart') }} = document.getElementById('{{ id|default('chart-doughnut') }}').getContext('2d');
    new Chart(ctx_{{ id|default('chart') }}, {
        type: 'doughnut',
        data: {
            labels: {{ labels|json_encode|raw }},
            datasets: [{
                data: {{ data|json_encode|raw }},
                backgroundColor: [
                    '#36A2EB','#FF6384','#FFCE56','#4BC0C0','#9966FF','#FF9F40'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 14 },
                    formatter: function(value, context) {
                        let total = context.chart._metasets[context.datasetIndex].total;
                        let percentage = ((value / total) * 100).toFixed(2) + '%';
                        return percentage + '\n' + value;
                    },
                    anchor: 'center',
                    align: 'center'
                }
            }
        }
    });
</script>
