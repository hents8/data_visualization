<div class="temporal-chart">
    <div class="temporal-chart-header">
        <h2>Évolution mensuelle des réponses</h2>
    </div>
    <canvas id="{{ id }}"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('{{ id }}').getContext('2d');

    // Labels : noms des mois
    const labels = [
        {% for i in 1..12 %}
            '{{ months[i] }}'{% if not loop.last %}, {% endif %}
        {% endfor %}
    ];

    // Datasets : un dataset par année
    const datasets = [
        {% for year, monthsData in monthlyTotalsByYear %}
        {
            label: '{{ year }}',
            data: [
                {% for m in 1..12 %}
                    {{ monthsData[m] ?? 0 }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            ],
            fill: false,
            borderColor: 'hsl({{ loop.index0 * 60 }}, 70%, 50%)',
            backgroundColor: 'hsl({{ loop.index0 * 60 }}, 70%, 50%)',
            tension: 0.3
        }{% if not loop.last %}, {% endif %}
        {% endfor %}
    ];

    new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
            responsive: true,
			maintainAspectRatio: false,
			layout: {
				padding: {
					bottom: 8
				}
			},
            plugins: { 
                legend: { position: 'top' }, 
                tooltip: { mode: 'index', intersect: false } 
            },
           scales: {
					y: {
						beginAtZero: true,
						ticks: {
							stepSize: 20, 
							maxTicksLimit: 5,
							precision: 0,
							padding: 4,          // réduit l'espace entre l'axe et les labels
							font: {
								size: 11         // taille du texte de l’axe Y
							}
						}
					},
					x: {
						ticks: {
							font: {
								size: 12
							}
						}
					}
				}

        }
    });
});
</script>
